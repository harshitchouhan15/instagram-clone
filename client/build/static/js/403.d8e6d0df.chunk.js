"use strict";(self.webpackChunkshopping=self.webpackChunkshopping||[]).push([[403],{5403:function(n,e,t){t.r(e),t.d(e,{default:function(){return G}});var r,i,o,d,a,s,l,c,u,f,v,p,h,x,m,g,w=t(168),Z=t(4165),b=t(5861),k=t(9439),j=t(3044),y=t(6151),C=t(3197),P=t(3688),S=t(1686),M=t(2791),_=t(9434),I=t(6487),z=t(2686),E=t(498),A=t(3768),B=t(1087),N=t(2271),T=t(3433),U=t(184),D=function(n){var e=n.selected,t=n.allChatMessages,r=n.setAllChatMessages,i=n.show,o=n.setShow,d=n.chats,a=n.setChats,s=n.setSelected,l=n.setIndex,c=n.newChat,u=n.setNewChat,f=n.setShowChat,v=(0,M.useState)([]),p=(0,k.Z)(v,2),h=p[0],x=p[1],m=(0,M.useState)(""),g=(0,k.Z)(m,2),w=g[0],y=g[1],S=(0,M.useState)([]),I=(0,k.Z)(S,2),z=I[0],E=I[1],A=(0,M.useState)([]),B=(0,k.Z)(A,2),N=B[0],D=B[1],q=(0,_.v9)((function(n){return n.user.currentUser})),G=(0,_.v9)((function(n){return n.darkMode}));return(0,M.useEffect)((function(){var n=function(){var n=(0,b.Z)((0,Z.Z)().mark((function n(){var e;return(0,Z.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,C.b.get("/users/all/users",{headers:{token:"Bearer "+(null===q||void 0===q?void 0:q.accessToken)}});case 2:e=n.sent,x(e.data);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}),[q]),(0,M.useEffect)((function(){var n=function(){var n=(0,b.Z)((0,Z.Z)().mark((function n(){var e,t;return(0,Z.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e={members:[null===q||void 0===q?void 0:q._id,null===c||void 0===c?void 0:c._id],membersName:[null===q||void 0===q?void 0:q.username,null===c||void 0===c?void 0:c.username],membersPhoto:[null===c||void 0===c?void 0:c.profilePic,null===q||void 0===q?void 0:q.profilePic]},n.prev=1,n.next=4,C.b.post("/chats/create",e,{headers:{token:"Bearer "+(null===q||void 0===q?void 0:q.accessToken)}});case 4:t=n.sent,d.every((function(n){return n._id!==t.data._id}))?(a((function(n){return[t.data].concat((0,T.Z)(n))})),s(t.data),E((function(n){return[t.data].concat((0,T.Z)(n))})),r((function(n){return[].concat((0,T.Z)(n),[[]])})),D((function(n){return[{}].concat((0,T.Z)(n))}))):u(null),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),console.log(n.t0);case 12:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}();c&&n()}),[c,q]),(0,M.useEffect)((function(){if(c)l(t.length-1);else{var n=t.findIndex((function(n){var t;return(null===(t=n[0])||void 0===t?void 0:t.conversationId)===(null===e||void 0===e?void 0:e._id)}));l(n)}}),[e,t]),(0,M.useEffect)((function(){if(!c){var n=[];t.forEach((function(e){var t=e[e.length-1];t&&n.push(t)}));var e=[],r=n.sort((function(n,e){return new Date(null===e||void 0===e?void 0:e.createdAt)-new Date(null===n||void 0===n?void 0:n.createdAt)}));r.forEach((function(n){var t=d.find((function(e){return e._id===(null===n||void 0===n?void 0:n.conversationId)}));e.push(t)})),D(r),E(e)}}),[t,e,c]),(0,U.jsxs)(F,{show:i,darkMode:G,children:[(0,U.jsx)(R,{onChange:function(n){return y(n.target.value.toLowerCase())},value:w,placeholder:"Search..."}),h.filter((function(n){return n.username.includes(w||n.name.toLowerCase().includes(w))})).map((function(n,e){return(0,U.jsxs)(V,{selected:n===c,onClick:function(){y(""),u(n),f(!0),o(!1)},children:[(0,U.jsx)(j.Z,{src:n.profilePic}),(0,U.jsx)("span",{children:n.username})]},e)})),z.map((function(n,t){var r,i,d,a;return(0,U.jsxs)(V,{selected:n===e,onClick:function(){s(n),f(!0),o(!1)},children:[(0,U.jsx)(j.Z,{src:null===n||void 0===n?void 0:n.membersPhoto.filter((function(n){return n!==(null===q||void 0===q?void 0:q.profilePic)}))[0]}),(0,U.jsxs)("span",{children:[(0,U.jsx)("h4",{children:null===n||void 0===n||null===(r=n.membersName)||void 0===r?void 0:r.filter((function(n){return n!==(null===q||void 0===q?void 0:q.username)}))}),(0,U.jsx)(L,{darkMode:G,selected:t===e,children:null===(i=N[t])||void 0===i?void 0:i.text})]}),(null===(d=N[t])||void 0===d?void 0:d.createdAt)&&(0,U.jsx)(W,{children:(0,P.WU)(null===(a=N[t])||void 0===a?void 0:a.createdAt)})]},t)}))]})},L=I.ZP.p(r||(r=(0,w.Z)(["\n  color: ",";\n  color: ",";\n  width: 80%;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n   \n    font-size: 14px;\n\n"])),(function(n){return n.darkMode?"#a2a2a3":"#666666"}),(function(n){return n.selected&&"#e5e5e8"})),W=I.ZP.span(i||(i=(0,w.Z)(["\nposition: absolute;\nright: 1.2px;\n\nfont-size: 13px;\n"]))),F=I.ZP.div(o||(o=(0,w.Z)(["\nposition: fixed;\nz-index: 3;\ndisplay: flex;    \nbackground-color: white;\nflex-direction: column;\nheight: 100vh;\ntop: 0;\nleft: 4.6vw;\nwidth: 25vw;\nbackground-color: ",";\ncolor: ",";\nborder-left: 0.5px solid #e4e3e6;\nborder-right: 0.5px solid #e4e3e6;\n@media screen and (max-width:768px){\n        \n        width: 100vw;\n        border: none;\n       left: 0;\n\n        height: 92.6vh;\n\ndisplay:","\n    }\n"])),(function(n){return n.darkMode&&"black"}),(function(n){return n.darkMode&&"white"}),(function(n){return n.show?"flex":"none"})),R=I.ZP.input(d||(d=(0,w.Z)(["\n        border: none;\n  width: 95%;\n     padding: 10px 20px;\n     border-radius: 3px;\n     font-size: 16px;\n     align-self: center;\n    background-color: #f5f3fb;\n    margin-block: 15px 10px;\n    &:focus{\n        outline: none;\n    }\n  \n"]))),V=I.ZP.div(a||(a=(0,w.Z)(["\n    display: flex;\n    gap: 8px;\n    \n    position: relative;\n    padding: 8px 20px;\n    transition: all 0.5s ease;\n    cursor: pointer;\n    background-color: ",";\n   color: ",";\n   transition: all  0.4s ease;\n   align-items: center;\n  \n   &:hover{\n    background-color: #66d1fc;\n   };\n    &>span{\n   \n       \ngap: 6px;\n      display: flex; \n      flex-direction : column ;\n}\n"])),(function(n){return n.selected&&"#0095f6"}),(function(n){return n.selected&&"white"})),q=t(7317),G=function(n){var e,t,r,i,o=n.socket,d=(0,M.useState)(!0),a=(0,k.Z)(d,2),s=a[0],l=a[1],c=(0,_.v9)((function(n){return n.user.currentUser})),u=(0,M.useState)(null),f=(0,k.Z)(u,2),v=f[0],p=f[1],h=(0,M.useState)(null),x=(0,k.Z)(h,2),m=x[0],g=x[1],w=(0,M.useState)(""),I=(0,k.Z)(w,2),T=I[0],L=I[1],W=(0,M.useState)(!1),F=(0,k.Z)(W,2),R=F[0],V=F[1],G=(0,_.v9)((function(n){return n.darkMode})),rn=(0,M.useRef)(),on=(0,M.useState)(!1),dn=(0,k.Z)(on,2),an=dn[0],sn=dn[1],ln=(0,M.useState)([]),cn=(0,k.Z)(ln,2),un=cn[0],fn=cn[1],vn=(0,M.useState)([]),pn=(0,k.Z)(vn,2),hn=pn[0],xn=pn[1],mn=(0,M.useState)(0),gn=(0,k.Z)(mn,2),wn=gn[0],Zn=gn[1],bn=(0,M.useState)(null),kn=(0,k.Z)(bn,2),jn=kn[0],yn=kn[1];(0,M.useEffect)((function(){var n;null===o||void 0===o||null===(n=o.current)||void 0===n||n.on("sendMessage",(function(n){g({text:n.text,senderId:n.senderId,createdAt:Date.now()})}))}),[]),(0,M.useEffect)((function(){var n,e=hn[wn];null===e||void 0===e||e.push(m);var t=hn.slice();t[wn]=e,m&&(null===jn||void 0===jn||null===(n=jn.members)||void 0===n?void 0:n.filter((function(n){return n!==(null===c||void 0===c?void 0:c._id)}))[0])===(null===m||void 0===m?void 0:m.senderId)&&xn(t)}),[m]),(0,M.useEffect)((function(){if(!v){var n=function(){var n=(0,b.Z)((0,Z.Z)().mark((function n(){var e,t,r;return(0,Z.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e=[],t=0;case 2:if(!(t<un.length)){n.next=10;break}return n.next=5,C.b.get("/messages/get/"+un[t]._id,{headers:{token:"Bearer "+(null===c||void 0===c?void 0:c.accessToken)}});case 5:null===(r=n.sent).data?e.push([]):e.push(r.data);case 7:t++,n.next=2;break;case 10:xn(e);case 11:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[un]),(0,M.useEffect)((function(){var n=function(){var n=(0,b.Z)((0,Z.Z)().mark((function n(){var e;return(0,Z.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,C.b.get("/chats/get/"+(null===c||void 0===c?void 0:c._id),{headers:{token:"Bearer "+(null===c||void 0===c?void 0:c.accessToken)}});case 2:e=n.sent,fn(e.data);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}),[c]);var Cn=function(){var n=(0,b.Z)((0,Z.Z)().mark((function n(){return(0,Z.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C.b.delete("/chats/delete/"+(null===jn||void 0===jn?void 0:jn._id),{headers:{token:"Bearer "+(null===c||void 0===c?void 0:c.accessToken)}});case 3:window.location.reload(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),console.error(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(){return n.apply(this,arguments)}}();(0,M.useEffect)((function(){var n;null===(n=rn.current)||void 0===n||n.scrollIntoView({behavior:"smooth"})}),[hn]),(0,M.useEffect)((function(){var n=function(){var n=(0,b.Z)((0,Z.Z)().mark((function n(){return(0,Z.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C.b.post("/messages/send",hn[wn][hn[wn].length-1],{headers:{token:"Bearer "+(null===c||void 0===c?void 0:c.accessToken)}});case 3:sn(!1),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),console.log(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(){return n.apply(this,arguments)}}();an&&n()}),[hn,an]);return(0,U.jsxs)(z.Flex,{children:[(0,U.jsx)(E.Z,{socket:o}),(0,U.jsx)(D,{showChat:R,setIndex:Zn,setAllChatMessages:xn,setShowChat:V,setNewChat:p,setSelected:yn,allChatMessages:hn,newChat:v,setShow:l,show:s,setChats:fn,chats:un,selected:jn}),(0,U.jsxs)(J,{showChat:R,children:[null===jn?(0,U.jsx)(H,{darkMode:G,children:(0,U.jsx)("h1",{children:"  Select a chat to start conversation"})}):(0,U.jsxs)(O,{children:[(0,U.jsxs)("span",{children:[(0,U.jsx)(Q,{onClick:function(){l(!0),V(!1)},children:(0,U.jsx)(q.Z,{fontSize:"medium",htmlColor:G?"white":"black"})}),(0,U.jsxs)(B.rU,{to:"/account/?user=".concat(null===jn||void 0===jn||null===(e=jn.members)||void 0===e?void 0:e.filter((function(n){return n!==(null===c||void 0===c?void 0:c._id)}))[0]),children:[" ",(0,U.jsx)(j.Z,{src:null===jn||void 0===jn?void 0:jn.membersPhoto.filter((function(n){return n!==(null===c||void 0===c?void 0:c.profilePic)}))[0]})," "]}),(0,U.jsxs)(B.rU,{to:"/account/?user=".concat(null===jn||void 0===jn||null===(t=jn.members)||void 0===t?void 0:t.filter((function(n){return n!==(null===c||void 0===c?void 0:c._id)}))[0]),className:G?"darkModeLink":"link",children:[(0,U.jsx)("span",{children:null===jn||void 0===jn||null===(r=jn.membersName)||void 0===r?void 0:r.filter((function(n){return n!==(null===c||void 0===c?void 0:c.username)}))[0]}),"   "]})]}),(0,U.jsx)(A.Z,{title:"Delete chat",arrow:!0,children:(0,U.jsx)(y.Z,{children:(0,U.jsx)(N.Z,{htmlColor:G?"white":"black",onClick:Cn})})})]}),jn&&(0,U.jsx)(K,{children:null===(i=hn[wn])||void 0===i?void 0:i.map((function(n,e){return(0,U.jsxs)(X,{ref:rn,left:c._id!==n.senderId,children:[(0,U.jsx)(j.Z,{src:n.senderId===(null===c||void 0===c?void 0:c._id)?null===c||void 0===c?void 0:c.profilePic:null===jn||void 0===jn?void 0:jn.membersPhoto.filter((function(n){return n!==(null===c||void 0===c?void 0:c.profilePic)}))[0]}),(0,U.jsxs)($,{left:c._id!==n.senderId,children:[" ",(0,U.jsx)("span",{children:null===n||void 0===n?void 0:n.text}),(0,U.jsx)(Y,{left:c._id!==n.senderId,children:(0,P.WU)(n.createdAt)})]})]},e)}))}),(0,U.jsxs)(nn,{darkMode:G,onSubmit:function(n){var e,t;n.preventDefault();var r={conversationId:null===jn||void 0===jn?void 0:jn._id,senderId:null===c||void 0===c?void 0:c._id,text:T};null===o||void 0===o||null===(e=o.current)||void 0===e||e.emit("getMessage",{senderId:c._id,recieverId:null===jn||void 0===jn||null===(t=jn.members)||void 0===t?void 0:t.filter((function(n){return n!==(null===c||void 0===c?void 0:c._id)}))[0],text:T});var i=hn[wn];null===i||void 0===i||i.push(r);var d=hn.slice();d[wn]=i,L(""),v&&p(null),xn(d),sn(!0)},children:[(0,U.jsx)(en,{disabled:null===jn,darkMode:G,type:"text",onChange:function(n){L(n.target.value)},value:T,placeholder:"Message"}),(0,U.jsx)(tn,{disabled:!T,type:"submit",children:(0,U.jsx)(S.Z,{fontSize:"inherit",htmlColor:T?"#0095f6":"#6a696a"})})]})]})]})},H=I.ZP.div(s||(s=(0,w.Z)(["\ndisplay: flex;\nalign-items: center;\njustify-content: center;\nheight: 100%;\ncolor: #b8b7b7;\ncolor: ",";\n&>h1{\n    font-size: 50px;\n    text-align:center;\n    \n}\n"])),(function(n){return n.darkMode&&"#626263"})),J=I.ZP.div(l||(l=(0,w.Z)(["\n    height: 100vh;\n    width: 71vw;\n  \n    position: relative;\n\n    \n    gap: 10px;\n    display: flex;\n    flex-direction: column;\n    @media screen and (max-width:768px){\n        width: 100vw;\n        display:",";\n       \n      z-index: 9999;\n        height: 100vh;\n       \n    }\n    \n"])),(function(n){return n.showChat?"flex":"none"})),K=I.ZP.div(c||(c=(0,w.Z)(["\ndisplay: flex;\nheight: 100%;\nflex-direction: column;\ngap: 8px;\noverflow-y: auto;\npadding: 10px;\n@media screen and (max-width:768px){\n   \n    }\n"]))),O=I.ZP.div(u||(u=(0,w.Z)(["\ndisplay: flex;\npadding:  10px ;\npadding-right: 25px;\nborder-bottom: 0.6px solid #dededf;\nalign-items: center;\nwidth: 100%;\nposition: sticky;\ntop: 0;\nwidth: 100%;\njustify-content: space-between;\n&>:last-child{\n    cursor:pointer;\n};\n&>span{\n    align-items: center;\n    gap: 8px;\n      display: flex;\n      font-size: 17px;\n      color: #363636;\n      padding-left: 10px;\n      @media screen and (max-width:768px){\n        gap: 5px;\n         font-size: 16px;\n        padding-left: 2px;\n          } \n};\n@media screen and (max-width:768px){\n       padding: 10px;\n\n          } \n\n\n"]))),Q=I.ZP.div(f||(f=(0,w.Z)(["\n    justify-content: center;\n    align-items: center;  \n    display:none;\n    margin-right: 5px;\n@media screen and (max-width:768px){  \ndisplay: flex;  \n    }\n"]))),X=I.ZP.div(v||(v=(0,w.Z)(["\n  \n    display:flex;\n    gap: 5px;\n    max-width: 50%;\n    min-height: max-content;\n    @media screen and (max-width:768px){  \nmax-width: 80% ;\n    };\n    align-self: ",";\n \n"])),(function(n){return n.left?"flex-start":"flex-end"})),Y=I.ZP.p(p||(p=(0,w.Z)(["\n    color: #3a393a;\n    font-size: 12px;\n  align-self:flex-end;\n  color:","\n    "])),(function(n){return n.left&&"#eaeaec"})),$=I.ZP.div(h||(h=(0,w.Z)(["\n border-radius: 5px;\n border-top-left-radius:0;\ndisplay: flex;\nflex-direction: column;\n align-self: start;\n    padding:5px 10px;\n    height: max-content;\n     font-size: 16px;\n    color: ",";\n   background-color: ","\n\n"])),(function(n){return n.left?"white":"black"}),(function(n){return n.left?"#0095f6":"#f3f3f3"})),nn=I.ZP.form(x||(x=(0,w.Z)(["\n    display: flex;\n    align-items: center;\n    border-radius: 25px;\n    \n    box-shadow: 1px 1px 2px 1px  ",";\n    position: sticky;\n    bottom: 0;\n    z-index: 2;\n    \n    justify-content: space-between;\n   width: 100%;\n   background-color: #f3f3f4;\n   background-color: ",";\n   padding: 10px 25px;\n\n   margin-bottom: 10px;\n   @media screen and (max-width:768px){\n       margin-bottom: 0;\n       padding:  10px 12px;\n         z-index: 9999;   \n          } \n"])),(function(n){return n.darkMode?"#444444":"#dedddf"}),(function(n){return n.darkMode&&"black"})),en=I.ZP.input(m||(m=(0,w.Z)(["\n    border: none;\n    width: 90%;\n    color: #292828;\n   color: ",";\n    font-size: 16px;\n    background-color: transparent;\n    &:disabled{\n        cursor: not-allowed;\n    };\n    &:focus{\n        outline: none;\n    }\n"])),(function(n){return n.darkMode&&"#d4d3d5"})),tn=I.ZP.button(g||(g=(0,w.Z)(["\n    background-color: transparent;\n   \n    cursor: pointer;\n    font-size: 23px;\n    border: none;\n    border-radius: 5px;\n    &:disabled{\n        cursor: not-allowed;\n    };\n"])))}}]);
//# sourceMappingURL=403.d8e6d0df.chunk.js.map